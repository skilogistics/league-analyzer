<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive League Analyzer</title>
    <!-- Chosen Palette: Warm Neutrals & Slate Blue -->
    <!-- Application Structure Plan: The application is designed as an interactive dashboard. The layout uses a two-column grid on larger screens. The main, wider column on the left contains the primary user workflow: Matchday selection via a slider, a section for inputting that day's results, and the main league table. This flow is intuitive: select a day, enter scores, update table. The right column provides secondary, summarized information: key league-wide statistics and a bar chart visualizing team points. This structure was chosen to separate the core data entry/viewing task from the supplementary analysis, preventing information overload while keeping key insights readily available. The user can focus on the day-to-day results while still getting a high-level visual overview of the league standings. -->
    <!-- Visualization & Content Choices: 
        - Report Info: League standings (P, W, D, L, etc.). Goal: Inform, Organize, Compare. Viz/Method: Interactive HTML Table. Interaction: Column header sorting. Justification: Standard, clear format for ranked data. Sorting allows user-driven analysis.
        - Report Info: Daily match results. Goal: Data Entry. Viz/Method: HTML Form Inputs. Interaction: User types in scores. Justification: Direct and universal method for data input.
        - Report Info: Team performance comparison. Goal: Compare. Viz/Method: Bar Chart. Interaction: Updates on table refresh, tooltips on hover. Justification: Provides a quick visual comparison of team points, easier to scan than the table. Library: Chart.js (Canvas).
        - Report Info: Navigating through the season. Goal: Change context. Viz/Method: HTML Range Slider. Interaction: User drags slider to select a day. Justification: Intuitive for navigating a fixed timeline (38 days).
        - Report Info: Key league stats (total goals, etc.). Goal: Inform. Viz/Method: Styled text blocks (Key Value pairs). Interaction: Updates on table refresh. Justification: Provides high-level summary stats at a glance.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .table-cell {
            padding: 0.75rem;
            text-align: center;
            white-space: nowrap;
        }
        .table-header {
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }
        .table-header:hover {
            background-color: #f1f5f9; /* slate-100 */
        }
        .btn-primary {
            background-color: #2563eb; /* blue-600 */
            color: white;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #1d4ed8; /* blue-700 */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-slate-900">Interactive League Analyzer</h1>
            <p class="mt-2 text-lg text-slate-600">Track daily matches, view live standings, and visualize team performance.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-8">
                <section id="controls" class="bg-white p-6 rounded-xl shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-slate-900">Season Controls</h2>
                    <div class="space-y-4">
                        <div>
                             <label for="matchday-slider" class="block mb-2 font-medium text-slate-700">Select Matchday: <span id="matchday-label" class="font-bold text-blue-600">1</span>/38</label>
                             <input type="range" id="matchday-slider" min="1" max="38" value="1" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <button id="update-table-btn" class="w-full sm:w-auto px-6 py-3 font-semibold rounded-lg btn-primary">
                            Update League Table
                        </button>
                    </div>
                     <p class="mt-4 text-sm text-slate-500">
                        This tool simulates a full 38-matchday season where each of the 20 teams plays every other team both home and away. Use the slider to select a matchday, enter the scores for the generated fixtures below, and click "Update League Table" to see the live standings.
                    </p>
                </section>
                
                <section id="fixtures-section" class="bg-white p-6 rounded-xl shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-slate-900">Matchday <span id="fixtures-day-label">1</span> Fixtures & Results</h2>
                    <p class="text-slate-600 mb-4">Enter the scores for the matches below. Leave scores blank for unplayed matches.</p>
                    <div id="fixtures-container" class="space-y-3"></div>
                </section>

                <section id="league-table-section" class="bg-white p-6 rounded-xl shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-slate-900">League Table</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-slate-200">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="table-header" data-sort="rank">#</th>
                                    <th class="table-header text-left" data-sort="name">Team</th>
                                    <th class="table-header" data-sort="p">P</th>
                                    <th class="table-header" data-sort="w">W</th>
                                    <th class="table-header" data-sort="d">D</th>
                                    <th class="table-header" data-sort="l">L</th>
                                    <th class="table-header" data-sort="gf">GF</th>
                                    <th class="table-header" data-sort="ga">GA</th>
                                    <th class="table-header" data-sort="gd">GD</th>
                                    <th class="table-header" data-sort="pts">Pts</th>
                                </tr>
                            </thead>
                            <tbody id="league-table-body" class="bg-white divide-y divide-slate-200">
                                <!-- Table rows will be generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
            
            <div class="lg:col-span-1 space-y-8">
                <section id="stats-summary" class="bg-white p-6 rounded-xl shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-slate-900">League Summary</h2>
                     <p class="text-slate-600 mb-4">
                        This section provides a high-level overview of the league's activity based on the results you've entered. It helps in understanding the overall offensive and defensive trends across all teams.
                    </p>
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div class="bg-slate-100 p-4 rounded-lg">
                            <p class="text-sm font-medium text-slate-500">Total Goals</p>
                            <p id="total-goals" class="text-3xl font-bold text-slate-900">0</p>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-lg">
                            <p class="text-sm font-medium text-slate-500">Matches Played</p>
                            <p id="matches-played" class="text-3xl font-bold text-slate-900">0</p>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-lg col-span-2">
                            <p class="text-sm font-medium text-slate-500">Goals per Match</p>
                            <p id="goals-per-match" class="text-3xl font-bold text-slate-900">0.00</p>
                        </div>
                    </div>
                </section>

                <section id="performance-chart-section" class="bg-white p-6 rounded-xl shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-slate-900">Team Points Comparison</h2>
                    <p class="text-slate-600 mb-4">
                        This chart visualizes the total points for each team, providing a quick comparison of their performance in the league so far. It dynamically updates every time you recalculate the league table.
                    </p>
                    <div class="chart-container relative w-full h-96 max-h-[400px] sm:h-auto sm:max-h-[500px] md:max-h-[600px] mx-auto max-w-2xl">
                        <canvas id="performance-chart"></canvas>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const TEAMS = ['ARS', 'AST', 'BHA', 'BOU', 'BRE', 'CHE', 'CRY', 'EVE', 'FOR', 'FUL', 'IPS', 'LEI', 'LIV', 'MCI', 'MUN', 'NEW', 'SOU', 'TOT', 'WHU', 'WOL'];
            let teamStats = {};
            let fixtures = [];
            let results = {};
            let performanceChart;

            let currentSort = {
                column: 'pts',
                direction: 'desc'
            };

            const slider = document.getElementById('matchday-slider');
            const matchdayLabel = document.getElementById('matchday-label');
            const fixturesDayLabel = document.getElementById('fixtures-day-label');
            const fixturesContainer = document.getElementById('fixtures-container');
            const updateBtn = document.getElementById('update-table-btn');
            const leagueTableBody = document.getElementById('league-table-body');
            
            const totalGoalsEl = document.getElementById('total-goals');
            const matchesPlayedEl = document.getElementById('matches-played');
            const goalsPerMatchEl = document.getElementById('goals-per-match');

            function initializeApp() {
                generateFixtures();
                resetTeamStats();
                displayFixtures(1);
                initializeChart(); // Moved this line up
                updateLeagueTable(); 
                addEventListeners();
            }

            function addEventListeners() {
                slider.addEventListener('input', (e) => {
                    const day = parseInt(e.target.value);
                    matchdayLabel.textContent = day;
                    fixturesDayLabel.textContent = day;
                    saveCurrentResults();
                    displayFixtures(day);
                });
                updateBtn.addEventListener('click', () => {
                    saveCurrentResults();
                    updateLeagueTable();
                });
                document.querySelectorAll('.table-header').forEach(header => {
                    header.addEventListener('click', (e) => {
                        const column = e.target.dataset.sort;
                        if (currentSort.column === column) {
                            currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                        } else {
                            currentSort.column = column;
                            currentSort.direction = ['name'].includes(column) ? 'asc' : 'desc';
                        }
                        renderTable();
                    });
                });
            }

            function generateFixtures() {
                const teams = [...TEAMS];
                if (teams.length % 2 !== 0) {
                    teams.push(null); // Add a dummy team for odd numbers
                }
                const numTeams = teams.length;
                const rounds = numTeams - 1;
                const halfSeasonFixtures = [];

                for (let round = 0; round < rounds; round++) {
                    const dailyFixtures = [];
                    for (let match = 0; match < numTeams / 2; match++) {
                        const home = teams[match];
                        const away = teams[numTeams - 1 - match];
                        if (home && away) {
                             dailyFixtures.push({ home, away });
                        }
                    }
                    halfSeasonFixtures.push(dailyFixtures);
                    
                    // Rotate teams
                    const lastTeam = teams.pop();
                    teams.splice(1, 0, lastTeam);
                }

                fixtures = [...halfSeasonFixtures];
                // Generate second half of the season (reverse fixtures)
                halfSeasonFixtures.forEach(dayFixtures => {
                    const reverseDayFixtures = dayFixtures.map(({ home, away }) => ({ home: away, away: home }));
                    fixtures.push(reverseDayFixtures);
                });
            }
            
            function resetTeamStats() {
                teamStats = {};
                TEAMS.forEach(team => {
                    teamStats[team] = { name: team, p: 0, w: 0, d: 0, l: 0, gf: 0, ga: 0, gd: 0, pts: 0 };
                });
            }

            function displayFixtures(day) {
                fixturesContainer.innerHTML = '';
                const dayFixtures = fixtures[day - 1] || [];
                dayFixtures.forEach((match, index) => {
                    const dayResults = results[day] || [];
                    const matchResult = dayResults[index] || { homeScore: '', awayScore: '' };

                    const fixtureEl = document.createElement('div');
                    fixtureEl.className = 'grid grid-cols-5 gap-2 items-center text-center';
                    fixtureEl.innerHTML = `
                        <span class="text-right font-medium col-span-2">${match.home}</span>
                        <div class="flex items-center justify-center gap-1">
                            <input type="number" min="0" class="w-12 text-center border rounded-md p-1 fixture-input" data-day="${day}" data-match-index="${index}" data-team="home" value="${matchResult.homeScore}">
                            <span>-</span>
                            <input type="number" min="0" class="w-12 text-center border rounded-md p-1 fixture-input" data-day="${day}" data-match-index="${index}" data-team="away" value="${matchResult.awayScore}">
                        </div>
                        <span class="text-left font-medium col-span-2">${match.away}</span>
                    `;
                    fixturesContainer.appendChild(fixtureEl);
                });
            }

            function saveCurrentResults() {
                const day = parseInt(slider.value);
                const inputs = document.querySelectorAll('.fixture-input');
                results[day] = results[day] || [];

                inputs.forEach(input => {
                    const matchIndex = parseInt(input.dataset.matchIndex);
                    const teamType = input.dataset.team;
                    if (!results[day][matchIndex]) {
                         results[day][matchIndex] = { homeScore: '', awayScore: '' };
                    }
                    if(teamType === 'home') {
                        results[day][matchIndex].homeScore = input.value;
                    } else {
                        results[day][matchIndex].awayScore = input.value;
                    }
                });
            }

            function updateLeagueTable() {
                resetTeamStats();
                let totalGoals = 0;
                let matchesPlayed = 0;

                for (let day = 1; day <= 38; day++) {
                    const dayResults = results[day] || [];
                    const dayFixtures = fixtures[day-1] || [];
                    dayResults.forEach((result, index) => {
                        const homeScore = parseInt(result.homeScore);
                        const awayScore = parseInt(result.awayScore);

                        if (!isNaN(homeScore) && !isNaN(awayScore)) {
                            const match = dayFixtures[index];
                            const homeTeam = teamStats[match.home];
                            const awayTeam = teamStats[match.away];
                            
                            homeTeam.p += 1;
                            awayTeam.p += 1;
                            homeTeam.gf += homeScore;
                            awayTeam.gf += awayScore;
                            homeTeam.ga += awayScore;
                            awayTeam.ga += homeScore;

                            if (homeScore > awayScore) {
                                homeTeam.w += 1;
                                homeTeam.pts += 3;
                                awayTeam.l += 1;
                            } else if (awayScore > homeScore) {
                                awayTeam.w += 1;
                                awayTeam.pts += 3;
                                homeTeam.l += 1;
                            } else {
                                homeTeam.d += 1;
                                awayTeam.d += 1;
                                homeTeam.pts += 1;
                                awayTeam.pts += 1;
                            }
                            totalGoals += homeScore + awayScore;
                            matchesPlayed++;
                        }
                    });
                }
                
                Object.values(teamStats).forEach(team => {
                    team.gd = team.gf - team.ga;
                });
                
                totalGoalsEl.textContent = totalGoals;
                matchesPlayedEl.textContent = matchesPlayed;
                goalsPerMatchEl.textContent = matchesPlayed > 0 ? (totalGoals / matchesPlayed).toFixed(2) : '0.00';

                renderTable();
                updateChart();
            }
            
            function sortStats(stats) {
                return stats.sort((a, b) => {
                    if (currentSort.direction === 'asc') {
                        [a, b] = [b, a]; // Swap for ascending
                    }

                    // Primary sort column
                    if (a[currentSort.column] < b[currentSort.column]) return 1;
                    if (a[currentSort.column] > b[currentSort.column]) return -1;
                    
                    // Tie-breakers
                    if (currentSort.column !== 'pts') {
                        if (a.pts < b.pts) return 1;
                        if (a.pts > b.pts) return -1;
                    }
                    if (currentSort.column !== 'gd') {
                        if (a.gd < b.gd) return 1;
                        if (a.gd > b.gd) return -1;
                    }
                    if (currentSort.column !== 'gf') {
                         if (a.gf < b.gf) return 1;
                         if (a.gf > b.gf) return -1;
                    }

                    // Alphabetical for final tie-break
                    if (a.name > b.name) return 1;
                    if (a.name < b.name) return -1;

                    return 0;
                });
            }

            function renderTable() {
                leagueTableBody.innerHTML = '';
                const sortedStats = sortStats(Object.values(teamStats));
                
                sortedStats.forEach((team, index) => {
                    const rank = index + 1;
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-slate-50';
                    row.innerHTML = `
                        <td class="table-cell font-medium">${rank}</td>
                        <td class="table-cell text-left font-semibold">${team.name}</td>
                        <td class="table-cell">${team.p}</td>
                        <td class="table-cell text-green-600">${team.w}</td>
                        <td class="table-cell text-yellow-600">${team.d}</td>
                        <td class="table-cell text-red-600">${team.l}</td>
                        <td class="table-cell">${team.gf}</td>
                        <td class="table-cell">${team.ga}</td>
                        <td class="table-cell font-medium">${team.gd}</td>
                        <td class="table-cell font-bold text-slate-900">${team.pts}</td>
                    `;
                    leagueTableBody.appendChild(row);
                });
            }
            
            function initializeChart() {
                const ctx = document.getElementById('performance-chart').getContext('2d');
                performanceChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Points',
                            data: [],
                            backgroundColor: 'rgba(59, 130, 246, 0.7)', // blue-500
                            borderColor: 'rgba(37, 99, 235, 1)', // blue-700
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        scales: {
                            x: {
                                beginAtZero: true,
                                grid: {
                                    color: '#e2e8f0' // slate-200
                                }
                            },
                            y: {
                                grid: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            },
                        }
                    }
                });
            }

            function updateChart() {
                const sortedStats = sortStats(Object.values(teamStats)).reverse(); // Reverse for chart display (top team at top)
                performanceChart.data.labels = sortedStats.map(t => t.name);
                performanceChart.data.datasets[0].data = sortedStats.map(t => t.pts);
                performanceChart.update();
            }

            initializeApp();
        });
    </script>
</body>
</html>
